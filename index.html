<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherNET 95</title>
    
    <style>
        /* --- Basic Setup and Body --- */
        body {
            background-color: #008080; /* Classic Teal Background */
            font-family: 'Tahoma', 'MS Sans Serif', 'Arial', sans-serif;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* --- Initial Connect Button Container --- */
        #connect-container {
            text-align: center;
            background-color: #C0C0C0;
            padding: 20px;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* --- Win95 Style Button --- */
        .win95-button {
            background-color: #C0C0C0;
            border: 1px solid;
            border-color: #ffffff #808080 #808080 #ffffff; /* Raised */
            box-shadow: 1px 1px 1px #404040;
            padding: 5px 15px;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            min-width: 75px; /* Standard button width */
            min-height: 23px; /* Standard button height */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .win95-button:active {
            border-color: #808080 #ffffff #ffffff #808080; /* Sunken */
            box-shadow: none;
            padding: 6px 14px 4px 16px; /* Shift text slightly */
        }
        .win95-button:focus {
            outline: 1px dotted #000000;
            outline-offset: -3px;
        }

        /* --- Main Window Styling (Initially Hidden) --- */
        #win95-window {
            width: 90%;
            max-width: 480px; /* Slightly wider */
            min-width: 320px;
            background-color: #C0C0C0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            padding: 3px;
            display: flex;
            flex-direction: column;
            /* Hidden initially, shown after connect */
            display: none;
        }

        /* --- Title Bar --- */
        .title-bar {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 3px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 20px;
            margin-bottom: 3px;
            flex-shrink: 0;
            cursor: default; /* Usually draggable, but not here */
        }

        .title-bar-text {
            font-weight: bold;
            letter-spacing: 0.5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex; /* Align icon and text */
            align-items: center;
        }

        .title-icon {
             width: 16px;
             height: 16px;
             margin-right: 4px;
        }


        /* --- Window Control Buttons (Visual Only) --- */
        .title-bar-controls {
             flex-shrink: 0;
        }
        .title-bar-controls button {
            width: 16px;
            height: 16px;
            margin-left: 2px;
            background-color: #C0C0C0;
            border: 1px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            box-shadow: 1px 1px 1px #404040;
            font-family: 'Marlett', 'System', sans-serif;
            font-size: 10px;
            font-weight: bold;
            padding: 0;
            line-height: 14px;
            color: black;
            cursor: default;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .title-bar-controls button:active {
             border-color: #808080 #ffffff #ffffff #808080;
             box-shadow: none;
        }

        /* --- Window Body --- */
        .window-body {
            background-color: #C0C0C0;
            padding: 10px;
            min-height: 250px; /* Increased height */
            border: 1px solid;
            border-color: #808080 #ffffff #ffffff #808080;
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 25px;
            position: relative;
        }

        /* --- Connection Status Panel --- */
        #connection-status {
            border: 2px inset #ffffff;
            background-color: #C0C0C0;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 120px; /* Increased height */
            max-height: 180px;
            overflow-y: auto;
            font-family: 'Lucida Console', 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4; /* Spacing */
            display: flex; /* Use flex for icon alignment */
            align-items: flex-start; /* Align icon top */
        }
        #connection-status-text {
            flex-grow: 1; /* Text takes remaining space */
        }
        #connection-status p {
            margin: 2px 0;
        }
        .connection-icon {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            flex-shrink: 0;
            /* Simple Globe/Modem Icon */
            fill: #000080;
        }


        /* --- Weather Display Area --- */
        #weather-display {
            /* Styles remain similar */
        }
        #weather-display h2 {
            margin-top: 0;
            font-size: 14px;
            border-bottom: 1px dotted #808080;
            padding-bottom: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .weather-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        #weather-display p {
            margin: 8px 0;
        }

        /* --- Status Bar --- */
        .status-bar {
          border: 1px solid;
          border-color: #808080 #ffffff #ffffff #808080;
          padding: 2px 4px;
          display: flex;
          margin-top: 10px;
          background-color: #C0C0C0;
        }
        .main-status {
            position: absolute;
            bottom: 3px;
            left: 3px;
            right: 3px;
            margin-top: 0;
            height: 20px;
            box-sizing: border-box;
        }
        .status-bar-field {
          flex: 1;
          margin: 0 2px;
          padding: 0 4px;
          border-right: 1px solid #808080;
          border-bottom: 1px solid #808080;
          border-left: 1px solid #ffffff;
          border-top: 1px solid #ffffff;
          font-size: 11px;
          line-height: 16px;
          overflow: hidden;
          white-space: nowrap;
          text-overflow: ellipsis;
          min-width: 50px;
        }
        .status-bar-field:last-child {
            border-right: none;
        }

        /* --- Notice Styling --- */
        .notice {
            font-size: 10px;
            color: #404040;
            margin-top: 15px;
            text-align: center;
        }
        .error-notice {
             color: #8B0000; /* Dark Red for errors */
             font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="connect-container">
        <p>Click Connect to access WeatherNET 95</p>
        <button id="connect-button" class="win95-button">Connect</button>
    </div>

    
    <div id="win95-window">
        <div class="title-bar">
             <div class="title-bar-text">
                 <svg class="title-icon" id="window-title-icon" viewBox="0 0 24 24" fill="#C0C0C0" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><path d="M0 0h24v24H0z" fill="none"/></svg>
                 <span id="window-title-text">WeatherNET 95 - Idle</span>
             </div>
            <div class="title-bar-controls">
                <button aria-label="Minimize" disabled>_</button>
                <button aria-label="Maximize" disabled>&#9633;</button>
                <button aria-label="Close" disabled>X</button>
            </div>
        </div>

        <div class="window-body">
            <div id="connection-status">
                 <svg class="connection-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 2 C8.268 2 2 8.268 2 16 s6.268 14 14 14 s14 -6.268 14 -14 S23.732 2 16 2 z M16 28 C9.373 28 4 22.627 4 16 S9.373 4 16 4 s12 5.373 12 12 S22.627 28 16 28 z" fill="#808080"/>
                    <path d="M16 5 C11.589 5 8 8.589 8 13 L8 19 C8 23.411 11.589 27 16 27 C20.411 27 24 23.411 24 19 L24 13 C24 8.589 20.411 5 16 5 z M16 25 C12.691 25 10 22.309 10 19 L10 13 C10 10.691 12.691 8 16 8 C19.309 8 22 10.691 22 13 L22 19 C22 22.309 19.309 25 16 25 z" fill="#000080"/>
                    <rect x="14" y="12" width="4" height="8" fill="#008080"/>
                 </svg>
                 <div id="connection-status-text">
                     <p>Ready to connect...</p>
                 </div>
            </div>

            <div id="weather-display" style="display: none;">
                <h2>
                    <svg class="weather-icon" id="weather-condition-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                        <path d="M41.5 21C39.51 14.84 33.27 10 26 10c-7.73 0-14 6.27-14 14 0 .76.07 1.51.21 2.24C6.79 27.2 2 32.28 2 38.5 2 45.4 7.6 51 14.5 51h31C52.95 51 59 44.95 59 37.5c0-6.97-5.16-12.74-11.94-13.75C45.38 22.4 43.6 21.34 41.5 21z" fill="#B0B0B0" stroke="#808080" stroke-width="2"/>
                    </svg>
                    Weather Report
                </h2>
                <p><strong>Location:</strong> <span id="location">Loading...</span></p>
                <p><strong>Date:</strong> <span id="weather-date">Loading...</span></p>
                <div class="status-bar">
                    <p class="status-bar-field" id="condition">Condition: --</p>
                    <p class="status-bar-field" id="temp">Temp: --°F</p>
                    <p class="status-bar-field" id="humidity">Humidity: --%</p>
                </div>
                <p id="data-notice" class="notice">*Specific historical weather data for 1995 is based on researched records, not a live API.</p>
            </div>

             <div class="status-bar main-status">
                <p class="status-bar-field" id="app-status">Idle</p>
            </div>
        </div>
    </div>

    
    <audio id="dialup-audio" 
           src="https://www.soundjay.com/communication/sounds/dial-up-modem-01.mp3" 
           preload="auto" 
           style="display: none;">
           Your browser does not support the audio element.
    </audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const connectContainer = document.getElementById('connect-container');
            const connectButton = document.getElementById('connect-button');
            const win95Window = document.getElementById('win95-window');
            const connectionStatusDiv = document.getElementById('connection-status');
            const connectionStatusText = document.getElementById('connection-status-text');
            const weatherDisplayDiv = document.getElementById('weather-display');
            const windowTitleText = document.getElementById('window-title-text');
            const appStatus = document.getElementById('app-status');
            const weatherConditionIcon = document.getElementById('weather-condition-icon');
            const dialupAudio = document.getElementById('dialup-audio');

            const DEFAULT_SIMULATION_TIME = 15; // Default time in seconds if audio fails

            // --- Dial-Up Simulation Text Steps ---
            const dialUpTextSteps = [
                "Initializing Modem...",
                "Dialing ISP (555-DIAL)...",
                "Connecting at 56 kbps...",
                "Authenticating User...",
                "Connection Established!"
            ];

            let simulationTimer = null; // To hold the setTimeout reference

            // --- Function to run the simulation steps ---
            function runSimulationSteps(duration) {
                console.log(`Starting simulation with duration: ${duration} seconds`);
                connectionStatusText.innerHTML = ''; // Clear previous text
                const stepInterval = (duration * 1000) / dialUpTextSteps.length; // Interval in ms

                dialUpTextSteps.forEach((text, index) => {
                    setTimeout(() => {
                        console.log(`Displaying step ${index}: ${text}`);
                        connectionStatusText.innerHTML += `<p>${text}</p>`;
                        connectionStatusDiv.scrollTop = connectionStatusDiv.scrollHeight;
                        appStatus.textContent = text;
                        windowTitleText.textContent = `WeatherNET 95 - ${text}`;

                        // If it's the last step, prepare to show weather
                        if (index === dialUpTextSteps.length - 1) {
                            // Set final title and status
                            windowTitleText.textContent = "WeatherNET 95 - Connected";
                            appStatus.textContent = "Fetching weather data...";
                            // Fetch weather slightly after the last message appears
                            setTimeout(() => {
                                connectionStatusDiv.style.display = 'none'; // Hide connection panel
                                fetchAndDisplayHistoricalWeather();
                            }, 500); // Short delay after "Connected!"
                        }
                    }, index * stepInterval);
                });
            }


            // --- Weather Fetching and Display (Remains the same) ---
            function fetchAndDisplayHistoricalWeather() {
                const location = "New York, NY";
                const today = new Date();
                const historicalDate = new Date(today);
                historicalDate.setFullYear(1995);

                const formattedDate = historicalDate.toLocaleDateString('en-US', {
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
                });

                const simulatedWeather = {
                    condition: "Partly Cloudy, Cool",
                    tempF: 50,
                    humidity: 60
                };
                updateWeatherIcon(simulatedWeather.condition);

                setTimeout(() => {
                    document.getElementById('location').textContent = location;
                    document.getElementById('weather-date').textContent = formattedDate;
                    document.getElementById('condition').textContent = `Condition: ${simulatedWeather.condition}`;
                    document.getElementById('temp').textContent = `Temp: ${simulatedWeather.tempF}°F`;
                    document.getElementById('humidity').textContent = `Humidity: ${simulatedWeather.humidity}%`;

                    weatherDisplayDiv.style.display = 'block';
                    appStatus.textContent = "Weather data loaded.";
                    windowTitleText.textContent = "WeatherNET 95 - Report";
                }, 500); // Reduced delay as connection panel is already hidden
            }

            // --- Helper to Update Weather Icon (Remains the same) ---
            function updateWeatherIcon(condition) {
                let iconSvg = '';
                const lowerCondition = condition.toLowerCase();
                 if (lowerCondition.includes("cloudy")) {
                     iconSvg = `<path d="M41.7 21.3C39.7 15.1 33.5 10 26 10c-7.7 0-14 6.3-14 14 0 .8.1 1.5.2 2.2C6.8 27.2 2 32.3 2 38.5 2 45.4 7.6 51 14.5 51h31C52.9 51 59 45 59 37.5c0-7-5.2-12.7-11.9-13.8C45.4 22.4 43.6 21.3 41.7 21.3z" fill="#F0F0F0" stroke="#888" stroke-width="1.5"/><path d="M51.5 31.5c4.1 0 7.5 3.4 7.5 7.5s-3.4 7.5-7.5 7.5h-31C13.1 46.5 7 40.4 7 33c0-6.2 4.4-11.4 10.2-12.8.5-.1.9-.4 1.1-.9.6-1.2.9-2.5.9-3.8 0-5.5 4.5-10 10-10 5.1 0 9.4 3.8 9.9 8.8.1.7.6 1.2 1.3 1.3 5.2.7 9.1 5.1 9.1 10.4z" fill="#FFF" stroke="#AAA" stroke-width="1" transform="translate(-4, -4) scale(1.1)"/>`;
                } else if (lowerCondition.includes("sunny") || lowerCondition.includes("clear")) {
                    iconSvg = `<circle cx="32" cy="32" r="12" fill="#FFD700" stroke="#FFA500" stroke-width="2"/><line x1="32" y1="8" x2="32" y2="14" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="32" y1="50" x2="32" y2="56" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="56" y1="32" x2="50" y2="32" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="14" y1="32" x2="8" y2="32" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="49.5" y1="14.5" x2="45.2" y2="18.8" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="18.8" y1="45.2" x2="14.5" y2="49.5" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="49.5" y1="49.5" x2="45.2" y2="45.2" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/><line x1="18.8" y1="18.8" x2="14.5" y2="14.5" stroke="#FFA500" stroke-width="2" stroke-linecap="round"/>`;
                } else if (lowerCondition.includes("rain") || lowerCondition.includes("showers")) {
                     iconSvg = `<path d="M41.7 21.3C39.7 15.1 33.5 10 26 10c-7.7 0-14 6.3-14 14 0 .8.1 1.5.2 2.2C6.8 27.2 2 32.3 2 38.5 2 45.4 7.6 51 14.5 51h31C52.9 51 59 45 59 37.5c0-7-5.2-12.7-11.9-13.8C45.4 22.4 43.6 21.3 41.7 21.3z" fill="#B0C4DE" stroke="#778899" stroke-width="1.5"/> <line x1="20" y1="42" x2="24" y2="52" stroke="#4682B4" stroke-width="2.5" stroke-linecap="round"/> <line x1="30" y1="44" x2="34" y2="54" stroke="#4682B4" stroke-width="2.5" stroke-linecap="round"/> <line x1="40" y1="42" x2="44" y2="52" stroke="#4682B4" stroke-width="2.5" stroke-linecap="round"/>`;
                }
                 else {
                    iconSvg = `<path d="M41.5 21C39.51 14.84 33.27 10 26 10c-7.73 0-14 6.27-14 14 0 .76.07 1.51.21 2.24C6.79 27.2 2 32.28 2 38.5 2 45.4 7.6 51 14.5 51h31C52.95 51 59 44.95 59 37.5c0-6.97-5.16-12.74-11.94-13.75C45.38 22.4 43.6 21.34 41.5 21z" fill="#B0B0B0" stroke="#808080" stroke-width="2"/>`;
                }
                weatherConditionIcon.innerHTML = iconSvg;
            }

            // --- Handle Audio Loading Success ---
            function handleAudioLoad() {
                 if (dialupAudio.duration && !isNaN(dialupAudio.duration)) {
                    console.log(`Audio loaded. Duration: ${dialupAudio.duration} seconds.`);
                    // Play audio and start simulation based on its duration
                    dialupAudio.play().catch(e => {
                         console.error("Audio play failed:", e);
                         displayAudioError("Could not play audio.");
                         runSimulationSteps(DEFAULT_SIMULATION_TIME); // Fallback timing
                    });
                    runSimulationSteps(dialupAudio.duration);
                } else {
                    // Duration not available even after metadata loaded? Fallback.
                    console.warn("Audio duration not available after metadata load.");
                    displayAudioError("Could not get audio duration.");
                    runSimulationSteps(DEFAULT_SIMULATION_TIME);
                }
            }

             // --- Handle Audio Loading Errors (CORS, Network, etc.) ---
             function handleAudioError(e) {
                console.error("Error loading audio:", e);
                // Display error in the status panel
                displayAudioError("Failed to load dial-up sound (Network/CORS issue?).");
                // Run simulation with default timing
                runSimulationSteps(DEFAULT_SIMULATION_TIME);
             }

             function displayAudioError(message) {
                 connectionStatusText.innerHTML += `<p class="error-notice">${message}</p>`;
                 connectionStatusText.innerHTML += `<p>Using default timing...</p>`;
                 connectionStatusDiv.scrollTop = connectionStatusDiv.scrollHeight; // Scroll to show error
             }

             // Add error handler to the audio element
             dialupAudio.addEventListener('error', handleAudioError);


            // --- Event Listener for Connect Button ---
            connectButton.addEventListener('click', () => {
                // Hide connect button and show the main window
                connectContainer.style.display = 'none';
                win95Window.style.display = 'flex';

                // Prepare the connection status panel
                connectionStatusText.innerHTML = '<p>Preparing connection...</p>';
                appStatus.textContent = "Preparing...";
                windowTitleText.textContent = "WeatherNET 95 - Connecting...";

                // Try to load and play the audio
                // Check if metadata (including duration) is already loaded
                if (dialupAudio.readyState >= 1) { // HAVE_METADATA or more
                     handleAudioLoad();
                } else {
                    // Wait for metadata to load if not ready
                    console.log("Audio metadata not ready, waiting for 'loadedmetadata' event...");
                    dialupAudio.addEventListener('loadedmetadata', handleAudioLoad, { once: true });
                     // Add a timeout fallback in case loadedmetadata never fires (e.g., invalid URL)
                     setTimeout(() => {
                         if (dialupAudio.readyState < 1) {
                             console.warn("Timeout waiting for audio metadata.");
                             handleAudioError(new Error("Timeout waiting for metadata"));
                             dialupAudio.removeEventListener('loadedmetadata', handleAudioLoad); // Clean up listener
                         }
                     }, 5000); // 5 second timeout
                }
            });

        });
    </script>
</body>
</html>
